<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PersonalPlannerApp.ViewModels"
             x:Class="PersonalPlannerApp.Views.MindPage"
             x:Name="TheMindPage"
             Title="Mind"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#121212}">

    <Grid>
        <Grid RowDefinitions="Auto, *" Padding="20" RowSpacing="15">
            
            <Label Text="My Mind" FontSize="30" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>

            <CollectionView Grid.Row="1" ItemsSource="{Binding MindItems}" SelectionMode="None">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="15"/>
                </CollectionView.ItemsLayout>
                
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="10" Margin="0,50,0,0">
                        <Label Text="🧠" FontSize="60"/>
                        <Label Text="Henüz not yok." TextColor="Gray"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems Mode="Reveal">
                                    <SwipeItem Text="Delete" BackgroundColor="#FF3B30"
                                               Command="{Binding Source={x:Reference TheMindPage}, Path=BindingContext.DeleteItemCommand}"
                                               CommandParameter="{Binding .}"/>
                                </SwipeItems>
                            </SwipeView.RightItems>
                            
                            <Frame CornerRadius="15" Padding="15" BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}" BorderColor="Transparent">
                                <VerticalStackLayout Spacing="5">
                                    <Label Text="{Binding Title}" FontSize="18" FontAttributes="Bold" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                                    <Label Text="{Binding Content}" TextColor="{AppThemeBinding Light=#333, Dark=#CCC}" LineBreakMode="WordWrap"/>
                                    <Label Text="{Binding CreatedDate, StringFormat='{0:dd MMM HH:mm}'}" TextColor="Gray" FontSize="11" HorizontalOptions="End"/>
                                </VerticalStackLayout>
                                <Frame.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={x:Reference TheMindPage}, Path=BindingContext.EditItemCommand}" CommandParameter="{Binding .}"/>
                                </Frame.GestureRecognizers>
                            </Frame>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Button Grid.Row="1" Text="+" Command="{Binding AddItemCommand}"
                    FontSize="30" TextColor="White" BackgroundColor="{AppThemeBinding Light=Black, Dark=#52D1DC}"
                    WidthRequest="60" HeightRequest="60" CornerRadius="30"
                    HorizontalOptions="End" VerticalOptions="End" Margin="10"/>
        </Grid>

        <Grid BackgroundColor="#99000000" IsVisible="{Binding IsPopupVisible}" ZIndex="999">
            <Frame VerticalOptions="Center" HorizontalOptions="Center" WidthRequest="320" CornerRadius="20" Padding="20" BackgroundColor="{AppThemeBinding Light=White, Dark=#252525}">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Not Ekle" FontSize="20" FontAttributes="Bold" HorizontalOptions="Center" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                    
                    <Entry Placeholder="Başlık..." Text="{Binding PopupTitle}" FontSize="16" FontAttributes="Bold"/>
                    <Editor Placeholder="Ne düşünüyorsun?" Text="{Binding PopupContent}" HeightRequest="150" AutoSize="TextChanges"/>

                    <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                        <Button Text="İptal" Command="{Binding ClosePopupCommand}" BackgroundColor="#EEE" TextColor="Black" Grid.Column="0"/>
                        <Button Text="Kaydet" Command="{Binding SaveItemCommand}" BackgroundColor="{AppThemeBinding Light=Black, Dark=#52D1DC}" TextColor="{AppThemeBinding Light=White, Dark=Black}" Grid.Column="1"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>